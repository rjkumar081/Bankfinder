<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IFSC Code Finder (Dropdown + API)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7; }
    .container { max-width: 900px; margin: auto; background: #fff; padding: 20px; box-shadow: 0 0 10px #ccc; border-radius: 10px; }
    h2, h3 { text-align: center; }
    input, select, button { width: 100%; padding: 10px; margin: 10px 0; }
    .results { margin-top: 20px; background: #eef; padding: 15px; border-radius: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>IFSC Code Finder (API + Dropdown)</h2>

    <!-- IFSC Code Search -->
    <h3>Search by IFSC Code</h3>
    <input type="text" id="ifscInput" placeholder="Enter IFSC Code">
    <button onclick="searchByIFSC()">Search</button>

    <hr>

    <!-- Dropdown Search -->
    <h3>Search by Bank Details</h3>
    <select id="bankSelect" onchange="loadStates()"></select>
    <select id="stateSelect" onchange="loadCities()"></select>
    <select id="citySelect" onchange="loadBranches()"></select>
    <select id="branchSelect"></select>
    <button onclick="searchByDropdown()">Search</button>

    <div class="results" id="resultBox" style="display:none;"></div>
  </div>

  <script>
    let bankData = [];

    async function loadData() {
      const res = await fetch('https://rjkumar081.github.io/bankfinder/banks.json'); // replace with your hosted JSON path
      bankData = await res.json();
      const banks = [...new Set(bankData.map(b => b.BANK))].sort();
      populateSelect('bankSelect', banks);
    }

    function populateSelect(id, list) {
      const sel = document.getElementById(id);
      sel.innerHTML = '<option value="">--Select--</option>';
      list.forEach(item => {
        const opt = document.createElement('option');
        opt.value = item;
        opt.textContent = item;
        sel.appendChild(opt);
      });
    }

    function loadStates() {
      const bank = document.getElementById('bankSelect').value;
      const states = [...new Set(bankData.filter(b => b.BANK === bank).map(b => b.STATE))].sort();
      populateSelect('stateSelect', states);
    }

    function loadCities() {
      const bank = document.getElementById('bankSelect').value;
      const state = document.getElementById('stateSelect').value;
      const cities = [...new Set(bankData.filter(b => b.BANK === bank && b.STATE === state).map(b => b.CITY))].sort();
      populateSelect('citySelect', cities);
    }

    function loadBranches() {
      const bank = document.getElementById('bankSelect').value;
      const state = document.getElementById('stateSelect').value;
      const city = document.getElementById('citySelect').value;
      const branches = [...new Set(bankData.filter(b => b.BANK === bank && b.STATE === state && b.CITY === city).map(b => b.BRANCH))].sort();
      populateSelect('branchSelect', branches);
    }

    function searchByIFSC() {
      const ifsc = document.getElementById('ifscInput').value.trim().toUpperCase();
      fetch(`https://ifsc.razorpay.com/${ifsc}`)
        .then(res => {
          if (!res.ok) throw new Error("Not found");
          return res.json();
        })
        .then(showResult)
        .catch(() => {
          document.getElementById('resultBox').innerHTML = 'Invalid or unavailable IFSC code.';
          document.getElementById('resultBox').style.display = 'block';
        });
    }

    function searchByDropdown() {
      const bank = document.getElementById('bankSelect').value;
      const state = document.getElementById('stateSelect').value;
      const city = document.getElementById('citySelect').value;
      const branch = document.getElementById('branchSelect').value;

      const result = bankData.find(b =>
        b.BANK === bank && b.STATE === state && b.CITY === city && b.BRANCH === branch
      );
      showResult(result);
    }

    function showResult(data) {
      const resultBox = document.getElementById('resultBox');
      if (!data) {
        resultBox.innerHTML = '<b>No result found.</b>';
      } else {
        resultBox.innerHTML = `
          <strong>Bank:</strong> ${data.BANK}<br>
          <strong>Branch:</strong> ${data.BRANCH}<br>
          <strong>IFSC:</strong> ${data.IFSC}<br>
          <strong>Address:</strong> ${data.ADDRESS}<br>
          <strong>City:</strong> ${data.CITY}<br>
          <strong>District:</strong> ${data.DISTRICT}<br>
          <strong>State:</strong> ${data.STATE}<br>
          <strong>Contact:</strong> ${data.CONTACT || 'N/A'}<br>
        `;
      }
      resultBox.style.display = 'block';
    }

    loadData();
  </script>
</body>
</html>